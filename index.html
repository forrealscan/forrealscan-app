<script>
document.getElementById("scanBtn").addEventListener("click", async () => {
    const fileInput = document.getElementById("fileInput");
    const resultDiv = document.getElementById("result");

    if (!fileInput.files || fileInput.files.length === 0) {
        resultDiv.innerHTML = "<b>Fehler:</b> Keine Datei ausgewählt.";
        return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onloadend = async () => {
        const base64String = reader.result.split(",")[1];

        try {
            const res = await fetch("/api/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    imageBase64: base64String
                })
            });

            const data = await res.json();
            console.log("API Antwort:", data);

            if (data.error) {
                resultDiv.innerHTML = `<b>Fehler:</b> ${data.error}`;
                return;
            }

            resultDiv.innerHTML = `
                <h3>Geschätzter KI-Anteil: ${data.score}%</h3>
                <p>Begründungen:</p>
                <ul>
                    ${data.reasons.map(r => `<li>${r}</li>`).join("")}
                </ul>
            `;
        } catch (err) {
            console.error(err);
            resultDiv.innerHTML = "<b>Fehler:</b> Serverproblem bei der Analyse.";
        }
    };

    reader.readAsDataURL(file);
});
</script>
